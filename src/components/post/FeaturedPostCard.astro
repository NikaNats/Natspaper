---
import { slugifyStr } from "@/utils/core";
import type { CollectionEntry } from "astro:content";
import Datetime from "./Datetime.astro";
import ReadingTime from "./ReadingTime.astro";
import { getReadingTimeDisplay } from "@/utils/post";

export interface Props {
  href: string;
  frontmatter: CollectionEntry<"blog">["data"];
  /** Post body for reading time calculation */
  body?: string;
}

const { href, frontmatter, body = "" } = Astro.props;
const {
  title,
  description,
  pubDatetime,
  modDatetime,
  timezone,
  tags = [],
} = frontmatter;

// Calculate reading time from body
const wordCount = body.split(/\s+/).length;
const readingTimeText = wordCount > 0 ? getReadingTimeDisplay(body) : "";

// Show max 2 tags in featured card
const tagPreview = tags.slice(0, 2);
---

<li class="featured-post-item" data-testid="post-card">
  <a
    href={href}
    class="group block no-underline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent focus-visible:outline-dashed"
  >
    <!-- Featured Post Card: Highlight with accent border -->
    <article
      class="post-featured-card relative rounded-lg border-2 border-accent/30 bg-linear-to-br from-muted/50 via-background to-background p-6 transition-all duration-300 group-hover:border-accent/60 group-hover:shadow-lg group-hover:shadow-accent/10"
    >
      <!-- Accent corner detail -->
      <div
        class="absolute top-0 right-0 h-16 w-16 rounded-bl-lg bg-accent/5 opacity-0 transition-opacity duration-300 group-hover:opacity-100"
      >
      </div>

      <!-- Featured Badge -->
      <div
        class="mb-3 inline-flex items-center gap-1 rounded-full bg-accent/10 px-3 py-1 text-xs font-semibold text-accent"
      >
        <span>‚≠ê</span>
        <span>Featured</span>
      </div>

      <!-- Title -->
      <h3
        class="text-xl font-bold text-foreground transition-colors duration-200 group-hover:text-accent"
        style={{ viewTransitionName: slugifyStr(title) }}
      >
        {title}
      </h3>

      <!-- Metadata: Date & Reading Time -->
      <div
        class="mt-4 flex flex-wrap items-center gap-4 text-sm text-text-secondary"
      >
        <Datetime {pubDatetime} {modDatetime} {timezone} />
        {readingTimeText && <ReadingTime text={readingTimeText} size="sm" />}
      </div>

      <!-- Multi-line excerpt for content preview -->
      <p class="mt-4 line-clamp-3 leading-relaxed text-foreground">
        {description}
      </p>

      <!-- Tags Preview -->
      {
        tagPreview.length > 0 && (
          <div class="mt-4 flex flex-wrap gap-2">
            {tagPreview.map(tag => (
              <span class="inline-block rounded-full bg-accent/10 px-2.5 py-1 text-xs font-medium text-accent transition-all duration-200 group-hover:bg-accent/20">
                #{tag}
              </span>
            ))}
            {tags.length > 2 && (
              <span class="inline-block text-xs text-text-secondary">
                +{tags.length - 2}
              </span>
            )}
          </div>
        )
      }
    </article>
  </a>
</li>

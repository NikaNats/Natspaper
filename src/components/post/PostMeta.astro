---
/**
 * PostMeta Molecule - Composite UI Pattern
 * =========================================
 * A reusable metadata display for posts, combining date, reading time,
 * and author information into a consistent layout.
 *
 * DESIGN PATTERN: Atomic Design - Molecule
 * - Composes atoms: Datetime, ReadingTime, Icon
 * - DRY: Eliminates repeated metadata layouts in cards
 * - Consistent: Same visual treatment across all post displays
 *
 * LAYOUT MODES:
 * - inline: Horizontal layout with separators (default)
 * - stacked: Vertical layout for narrow containers
 * - compact: Minimal, icon-only display
 *
 * @example
 * ```astro
 * <PostMeta
 *   pubDatetime={post.pubDatetime}
 *   readingTime="5 min"
 *   author="John Doe"
 * />
 * ```
 */
import Datetime from "@/components/post/Datetime.astro";
import ReadingTime from "@/components/post/ReadingTime.astro";
import Icon from "@/components/ui/Icon.astro";

export interface Props {
  /** Publication date */
  pubDatetime: Date;
  /** Modified date */
  modDatetime?: Date | null;
  /** Timezone for date display */
  timezone?: string;
  /** Reading time text (e.g., "5 min read") */
  readingTime?: string;
  /** Author name */
  author?: string;
  /** Layout mode */
  layout?: "inline" | "stacked" | "compact";
  /** Size variant */
  size?: "sm" | "md" | "lg";
  /** Show icons */
  showIcons?: boolean;
  /** Additional CSS classes */
  class?: string;
}

const {
  pubDatetime,
  modDatetime,
  timezone,
  readingTime,
  author,
  layout = "inline",
  size = "sm",
  showIcons = true,
  class: className = "",
} = Astro.props;

// Size mappings
const sizeClasses: Record<
  NonNullable<Props["size"]>,
  {
    wrapper: string;
    text: string;
    icon: string;
    gap: string;
  }
> = {
  sm: {
    wrapper: "gap-2 sm:gap-3",
    text: "text-xs sm:text-sm",
    icon: "size-3.5",
    gap: "gap-1",
  },
  md: {
    wrapper: "gap-3 sm:gap-4",
    text: "text-sm",
    icon: "size-4",
    gap: "gap-1.5",
  },
  lg: {
    wrapper: "gap-4 sm:gap-5",
    text: "text-base",
    icon: "size-5",
    gap: "gap-2",
  },
};

// Layout mappings
const layoutClasses: Record<NonNullable<Props["layout"]>, string> = {
  inline: "flex flex-wrap items-center",
  stacked: "flex flex-col items-start",
  compact: "flex items-center",
};

const currentSize = sizeClasses[size];
---

<div
  class:list={[
    layoutClasses[layout],
    currentSize.wrapper,
    currentSize.text,
    "text-text-secondary",
    className,
  ]}
>
  {/* Date */}
  <div class:list={["flex items-center", currentSize.gap]}>
    {
      showIcons && layout !== "compact" && (
        <Icon name="Calendar" class={currentSize.icon} />
      )
    }
    <Datetime {pubDatetime} {modDatetime} {timezone} />
  </div>

  {/* Separator for inline layout */}
  {
    layout === "inline" && (readingTime || author) && (
      <span class="text-border" aria-hidden="true">
        •
      </span>
    )
  }

  {/* Reading Time */}
  {
    readingTime && (
      <div class:list={["flex items-center", currentSize.gap]}>
        {showIcons && layout !== "compact" && (
          <Icon name="Clock" class={currentSize.icon} />
        )}
        <ReadingTime text={readingTime} size={size === "lg" ? "lg" : "sm"} />
      </div>
    )
  }

  {/* Separator for inline layout */}
  {
    layout === "inline" && author && readingTime && (
      <span class="text-border" aria-hidden="true">
        •
      </span>
    )
  }

  {/* Author */}
  {
    author && (
      <div class:list={["flex items-center", currentSize.gap]}>
        {showIcons && layout !== "compact" && (
          <svg
            class={currentSize.icon}
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            aria-hidden="true"
          >
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
            <circle cx="12" cy="7" r="4" />
          </svg>
        )}
        <span>{author}</span>
      </div>
    )
  }
</div>

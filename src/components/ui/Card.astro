---
/**
 * Card Component - Dumb/Presentational
 * =====================================
 * A flexible card container with consistent styling.
 * Follows Open/Closed Principle - extend via props and slots.
 *
 * DESIGN PATTERN: Composition over Inheritance
 * - Provides structure and styling only
 * - Content injected via default slot
 * - Header/footer via named slots
 *
 * EXTENSIBILITY:
 * - Use for PostCard, FeatureCard, ProfileCard, etc.
 * - Change appearance without creating new component files
 * - Single source of truth for card styling (DRY)
 *
 * @example
 * ```astro
 * <Card variant="outlined" padding="lg">
 *   <div slot="header">Card Title</div>
 *   <p>Card content here</p>
 *   <div slot="footer">Card actions</div>
 * </Card>
 * ```
 */

export interface Props {
  /**
   * Visual variant
   * - "default": Subtle background, no border
   * - "outlined": Border with transparent background
   * - "elevated": Shadow for depth
   * - "filled": Solid muted background
   * - "featured": Accent border highlight
   */
  variant?: "default" | "outlined" | "elevated" | "filled" | "featured";
  /** Padding size preset */
  padding?: "none" | "sm" | "md" | "lg";
  /** Make entire card clickable */
  href?: string;
  /** Interactive hover state */
  interactive?: boolean;
  /** Additional CSS classes */
  class?: string;
  /** HTML element to render */
  as?: "div" | "article" | "section" | "li";
}

const {
  variant = "default",
  padding = "md",
  href,
  interactive = !!href,
  class: className = "",
  as: Element = href ? "a" : "div",
} = Astro.props;

// Padding mappings
const paddingClasses: Record<NonNullable<Props["padding"]>, string> = {
  none: "p-0",
  sm: "p-3",
  md: "p-4 md:p-5",
  lg: "p-5 md:p-6 lg:p-8",
};

// Variant mappings
const variantClasses: Record<NonNullable<Props["variant"]>, string> = {
  default:
    "bg-[color-mix(in_srgb,var(--color-muted)_30%,transparent)] border-transparent",
  outlined:
    "bg-transparent border-[color-mix(in_srgb,var(--color-border)_60%,transparent)]",
  elevated: "bg-background border-transparent shadow-md",
  filled: "bg-muted border-transparent",
  featured: "bg-muted/30 border-l-4 border-l-accent border-y-0 border-r-0",
};

// Interactive state classes
const interactiveClasses = interactive
  ? "transition-all duration-200 hover:border-accent/40 hover:bg-muted/50 hover:shadow-lg hover:shadow-accent/5 focus-visible:outline-2 focus-visible:outline-accent focus-visible:outline-offset-2"
  : "";

const hasHeader = Astro.slots.has("header");
const hasFooter = Astro.slots.has("footer");
---

<Element
  class:list={[
    "card rounded-lg border",
    variantClasses[variant],
    paddingClasses[padding],
    interactiveClasses,
    className,
  ]}
  href={href}
>
  {
    hasHeader && (
      <div class="card-header mb-4 border-b border-border/30 pb-3">
        <slot name="header" />
      </div>
    )
  }

  <div class="card-body">
    <slot />
  </div>

  {
    hasFooter && (
      <div class="card-footer mt-4 border-t border-border/30 pt-3">
        <slot name="footer" />
      </div>
    )
  }
</Element>

<style>
  /* Reduced motion support */
  @media (prefers-reduced-motion: reduce) {
    .card {
      transition: none;
    }
    .card:hover {
      transform: none;
    }
  }
</style>

---
import type { GetStaticPaths } from "astro";
import { PostRepository } from "@/utils/post/repository";
import Layout from "@/layouts/Layout.astro";
import Header from "@/components/layout/Header.astro";
import Footer from "@/components/layout/Footer.astro";
import Hero from "@/components/features/Hero.astro";
import Socials from "@/components/features/Socials.astro";
import Hr from "@/components/ui/Hr.astro";
import FeaturedPostCard from "@/components/post/FeaturedPostCard.astro";
import { getSocials } from "@/data/socials";
import { getI18n, type Lang } from "@/i18n";
import { SUPPORTED_LANGS, DEFAULT_LANG } from "@/i18n/config";
import profilePic from "@/assets/images/me.jpeg";

export const getStaticPaths = (() => {
  return SUPPORTED_LANGS.map(locale => ({
    params: { locale },
  }));
}) satisfies GetStaticPaths;

const locale = (
  SUPPORTED_LANGS.includes(Astro.params.locale as Lang)
    ? Astro.params.locale
    : DEFAULT_LANG
) as Lang;

const { t } = getI18n(locale);
const sortedPosts = await PostRepository.getByLocale(locale);
const featuredPosts = sortedPosts.filter(({ data }) => data.featured);
const socials = getSocials();

const heroContentByLocale: Record<
  Lang,
  {
    tagline: string;
    techStack?: string[];
    additionalContent: string[];
  }
> = {
  en: {
    tagline: "Explorer of Ideas | ex.Physicist | Software Engineer",
    techStack: ["Physics", "Software Development", "Philosophy", "Cognition"],
    additionalContent: [
      `Hello, I'm <strong>Nika</strong>. Although I work as a software engineer, my background is rooted in Physics. 
      My Bachelor's degree in the field instilled in me a deep desire not merely to build systems, but to understand 
      the fundamental laws that govern our universe.`,

      `I am passionate about the art of <strong>thinking</strong> itself. I view coding, mathematics, and philosophy 
      as distinct languages for a singular pursuit: cognition. I am driven by the joy of problem-solving—whether 
      it involves deciphering a complex system architecture or exploring the nature of reality.`,

      `This website is a digital reflection of my curiosity. Here, you will find a blend of 
      <strong>technical research, personal observations, and life reflections</strong>. It serves as a chronicle 
      of my learning journey and my efforts to make sense of the world.`,
    ],
  },
  ka: {
    tagline: "იდეების მკვლევარი | ექს-ფიზიკოსი | ინჟინერი",
    techStack: ["ფიზიკა", "პროგრამული განვითარება", "ფილოსოფია", "შემეცნება"],
    additionalContent: [
      `გამარჯობა, მე <strong>ნიკა</strong> ვარ. პროფესიით პროგრამული ინჟინერი გახლავართ, თუმცა ფიზიკის ბაკალავრის ხარისხს ვფლობ. 
      ამ განათლემ არა მხოლოდ ახალი სისტემების შექმნის სურვილი გამიღვიძა, არამედ იმ ფუნდამენტური კანონების ღრმად გააზრების ინტერესიც, 
      რომლებიც სამყაროს მართავს.`,

      `გატაცებული ვარ <strong>აზროვნების პროცესით</strong>. კოდს, მათემატიკასა და ფილოსოფიას აღვიქვამ, როგორც შემეცნების 
      სხვადასხვა ენას. ჩემი მთავარი მოტივაცია პრობლემების გადაწყვეტაშია — იქნება ეს რთული სისტემური 
      არქიტექტურის აგება თუ რეალობის ბუნების კვლევა.`,

      `ეს ვებგვერდი ჩემი ცნობისმოყვარეობის ანარეკლია. აქ იხილავთ სტატიებს მრავალფეროვან თემებზე: 
      <strong>ტექნიკურ კვლევებს, პირად დაკვირვებებსა და ცხოვრებისეულ რეფლექსიებს</strong>. ეს არის სივრცე, 
      სადაც აღვწერ ჩემი განვითარების გზას და სამყაროს გააზრების მცდელობებს.`,
    ],
  },
};

const heroContent = heroContentByLocale[
  locale
] as (typeof heroContentByLocale)["en"];
---

<Layout>
  <Header />
  <main
    id="main-content"
    data-layout="index"
    class="mx-auto flex min-h-[calc(100svh-5rem)] w-full max-w-app flex-col items-center justify-center px-4 py-8"
  >
    <Hero
      name="Nika Natsvlishvili"
      tagline={heroContent.tagline}
      additionalContent={heroContent.additionalContent}
      profileImage={profilePic}
      profileAlt={locale === "en" ? "Nika Natsvlishvili" : "ნიკა ნაცვლიშვილი"}
      techStack={heroContent.techStack}
    >
      {
        socials.length > 0 && (
          <div slot="socials">
            <Socials links={socials} />
          </div>
        )
      }
    </Hero>

    {
      featuredPosts.length > 0 && (
        <>
          <Hr />
          <section id="featured-posts" class="w-full py-8">
            <h2 class="mb-6 text-2xl font-bold">{t("hero.featuredPosts")}</h2>
            <ul class="grid gap-4 sm:grid-cols-2">
              {featuredPosts.map(({ data, id, body }) => (
                <FeaturedPostCard
                  href={`/${locale}/posts/${id}`}
                  frontmatter={data}
                  body={body}
                />
              ))}
            </ul>
          </section>
        </>
      )
    }
  </main>
  <Footer />
</Layout>

<script>
  document.addEventListener("astro:page-load", () => {
    const indexLayout = (document.querySelector("#main-content") as HTMLElement)
      ?.dataset?.layout;
    if (indexLayout) {
      const pathParts = window.location.pathname.split("/").filter(Boolean);
      const locale = pathParts[0] || "en";
      sessionStorage.setItem("backUrl", `/${locale}/`);
    }
  });
</script>

---
import { PostRepository } from "@/utils/post/repository";
import Layout from "@/layouts/Layout.astro";
import Header from "@/components/layout/Header.astro";
import Footer from "@/components/layout/Footer.astro";
import Hero from "@/components/features/Hero.astro";
import Socials from "@/components/features/Socials.astro";
import Hr from "@/components/ui/Hr.astro";
import FeaturedPostCard from "@/components/post/FeaturedPostCard.astro";
import { getSocials } from "@/data/socials";
import { SITE } from "@/config";
import profilePic from "@/assets/images/me.jpeg";

// Get posts only for the English language using the centralized repository
const sortedPosts = await PostRepository.getByLocale("en");
const featuredPosts = sortedPosts.filter(({ data }) => data.featured);
const socials = getSocials();

// Hero content - structured for maintainability
const heroContent = {
  tagline: ".NET Developer  |  Software Engineer",
  techStack: [".NET Core", "Microservices", "AI/ML", "TypeScript", "Astro"],
  additionalContent: [
    `Recent highlights include leading the migration of a credit reporting
    system from monolith to microservices
    <span class="highlight">40% perf boost</span>, architecting a Georgian-language AI assistant that won the
    <span class="highlight">Jury's Favorite Award</span>
    at GAIA Hackathon, and designing enterprise-grade systems like <a
      href="https://github.com/NikaNats">Blogify API</a> and fintech microservices ecosystems.`,
    `Currently pursuing a Master's in Data Science at Georgian National
    University while working as a .NET Software Engineer at Credo Bank.
    Reach out by <a href="mailto:nika.nacvlishvili1@gmail.com">sending an email</a> to discuss .NET, microservices, or AI/ML integration.`,
  ],
};
---

<Layout>
  <Header />
  <main
    id="main-content"
    data-layout="index"
    class="mx-auto flex h-svh w-full max-w-app flex-col items-center justify-center px-4"
  >
    <Hero
      name={SITE.author}
      tagline={heroContent.tagline}
      description={SITE.desc}
      additionalContent={heroContent.additionalContent}
      profileImage={profilePic}
      profileAlt={`${SITE.author}'s profile photo`}
      techStack={heroContent.techStack}
    >
      {
        socials.length > 0 && (
          <div slot="socials">
            <Socials links={socials} />
          </div>
        )
      }
    </Hero>

    <Hr />

    {
      featuredPosts.length > 0 && (
        <>
          <Hr />
          <section id="featured-posts" class="py-8">
            <h2 class="mb-6 text-2xl font-bold">Featured Posts</h2>
            <ul class="grid gap-4 sm:grid-cols-2">
              {featuredPosts.map(({ data, id, body }) => (
                <FeaturedPostCard
                  href={`/en/posts/${id}`}
                  frontmatter={data}
                  body={body}
                />
              ))}
            </ul>
          </section>
        </>
      )
    }
  </main>
  <Footer />
</Layout>

<script>
  document.addEventListener("astro:page-load", () => {
    const indexLayout = (document.querySelector("#main-content") as HTMLElement)
      ?.dataset?.layout;
    if (indexLayout) {
      sessionStorage.setItem("backUrl", "/en/");
    }
  });
</script>

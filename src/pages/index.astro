---
// FILE: src/pages/index.astro

// This page is now a static HTML shell with a client-side script for redirection.
// It no longer uses any server-side Astro APIs.
import { SUPPORTED_LANGS, DEFAULT_LANG } from "@/i18n/config";
---

<!doctype html>
<html lang={DEFAULT_LANG} data-pagefind-ignore="all">
  <head>
    <meta charset="UTF-8" />
    <title>Redirecting...</title>
    <!-- Pass config variables to the client script -->
    <script
      is:inline
      define:vars={{
        supportedLocales: SUPPORTED_LANGS,
        defaultLocale: DEFAULT_LANG,
      }}
    >
      /**
       * Client-side redirect to the user's preferred language.
       * This runs instantly in the browser, preserving the benefits of a static site.
       */
      function getPreferredLocale() {
        // Check navigator.languages for the most specific user preference.
        for (const lang of navigator.languages) {
          const locale = lang.split("-")[0]; // Use the primary language code (e.g., "en" from "en-US")
          if (supportedLocales.includes(locale)) {
            return locale;
          }
        }
        // Fallback to the default locale.
        return defaultLocale;
      }

      // Perform the redirect.
      const preferredLocale = getPreferredLocale();
      window.location.pathname = `/${preferredLocale}/`;
    </script>
    <noscript>
      <!-- Fallback for users with JavaScript disabled -->
      <meta http-equiv="refresh" content={`0;url=/${DEFAULT_LANG}/`} />
    </noscript>
  </head>
  <body>
    <p>
      If you are not redirected automatically, <a href={`/${DEFAULT_LANG}/`}
        >click here</a
      >.
    </p>
  </body>
</html>

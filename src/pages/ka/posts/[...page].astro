---
import type { GetStaticPaths } from "astro";
import { getLastPathSegment } from "@/utils/core/slugify";
import Main from "@/layouts/Main.astro";
import Layout from "@/layouts/Layout.astro";
import Header from "@/components/layout/Header.astro";
import Footer from "@/components/layout/Footer.astro";
import PostSummaryCard from "@/components/post/PostSummaryCard.astro";
import Pagination from "@/components/ui/Pagination.astro";
import { PostRepository } from "@/utils/post/repository";
import { SITE, FEATURES } from "@/config";

export const getStaticPaths = (async ({ paginate }) => {
  const posts = await PostRepository.getByLocale("ka");
  return paginate(posts, { pageSize: FEATURES.postPerPage });
}) satisfies GetStaticPaths;

const { page } = Astro.props;
---

<Layout title={`პოსტები | ${SITE.title}`}>
  <Header />
  <Main
    pageTitle="პოსტები"
    pageDesc="ყველა სტატია რომელიც მე დავპოსტე."
    width="wide"
  >
    {
      /* 
      Responsive Post Grid:
      - Mobile (default): Single column stack for optimal readability
      - Ultra-wide (3xl+): 2 columns to utilize horizontal space
      - 4K (4xl+): 3 columns for maximum screen real estate
    */
    }
    <ul class="3xl:grid-cols-2 3xl:gap-8 4xl:grid-cols-3 grid gap-6">
      {
        page.data.map(({ data, slug, body }) => {
          // Calculate word count for reading time
          const wordCount = body.split(/\s+/).length;
          return (
            <PostSummaryCard
              title={data.title}
              description={data.description}
              pubDatetime={data.pubDatetime}
              modDatetime={data.modDatetime}
              timezone={data.timezone}
              slug={getLastPathSegment(slug)}
              wordCount={wordCount}
              tags={data.tags}
              featured={data.featured}
            />
          );
        })
      }
    </ul>
  </Main>

  <Pagination
    currentPage={page.currentPage}
    totalPages={page.lastPage}
    prevUrl={page.url.prev}
    nextUrl={page.url.next}
  />

  <Footer noMarginTop={page.lastPage > 1} />
</Layout>

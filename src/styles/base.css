/* src/styles/base.css */
@layer base {
  html {
    @apply scroll-smooth bg-background;
    font-family: var(--font-inter), var(--font-georgian), system-ui, sans-serif;
    font-size: 16px;

    /* 
      STABILITY FIX: 
      Stable scrollbar gutter prevents layout shift when content height changes.
      overflow-x: hidden on html prevents horizontal scrollbars from rogue animations/elements.
    */
    scrollbar-gutter: stable;
    overflow-x: hidden;

    /* UX: Offset scroll position for sticky headers */
    scroll-padding-top: calc(var(--header-height) + 1.5rem);

    @media (min-width: 768px) {
      font-size: 18px;
    }

    @media (prefers-reduced-motion: reduce) {
      scroll-behavior: auto;
    }
  }

  body {
    @apply flex min-h-svh flex-col font-sans text-foreground antialiased;
    line-height: 1.6;
    letter-spacing: 0.01em;
    /* 
       Overflow handling:
       - overflow-x: clip prevents horizontal scroll from rogue elements
       - Using 'clip' instead of 'hidden' preserves sticky positioning
       - Width 100% ensures full viewport coverage
    */
    width: 100%;
    overflow-x: clip;

    transition:
      background-color 0.3s ease,
      color 0.3s ease;
  }

  /**
   * Fluid Layout Container System
   * =============================
   * Content areas use the original --main-width for readability by default.
   * The fluid padding scales from mobile to 4K while keeping content centered.
   * Use .layout-wide or .layout-full classes to opt-out for specific sections.
   */
  section,
  footer {
    @apply mx-auto w-full px-4;
    /* Default to the original readable content width */
    max-width: var(--main-width);
  }

  /* Opt-in wider layout for sections that need it */
  section.layout-wide,
  footer.layout-wide {
    max-width: var(--layout-wide-width, 90rem);
    padding-inline: var(
      --layout-padding-fluid,
      clamp(1rem, 0.5rem + 3vw, 6rem)
    );
  }

  /* Full-width layout with fluid padding */
  section.layout-full,
  footer.layout-full {
    max-width: 100%;
    padding-inline: var(
      --layout-padding-fluid,
      clamp(1rem, 0.5rem + 3vw, 6rem)
    );
  }

  /* Global Resets */
  * {
    @apply border-border;
    scrollbar-width: thin;
    scrollbar-color: var(--muted) transparent;
  }

  :focus-visible {
    @apply outline-2 outline-offset-2 outline-accent;
  }

  button {
    @apply cursor-pointer touch-manipulation;
    &:active,
    &[role="button"]:active {
      transform: scale(0.98);
    }
  }

  /* Utility for locking scroll when mobile menu is open */
  body.overflow-hidden {
    overflow: hidden !important;
  }

  /* Enhanced Links */
  a:not(.no-underline) {
    text-decoration: underline 1px;
    text-underline-offset: 0.25em;
    text-decoration-color: var(--accent);
    transition:
      text-decoration-color 0.2s ease,
      text-decoration-thickness 0.2s ease;

    &:is(:hover, :focus-visible) {
      text-decoration-thickness: 2px;
    }
  }
}

/* --- UTILITIES --- */
/* Correct Tailwind v4 syntax for defining a custom utility */
@utility max-w-app {
  max-width: 768px; /* 732px inner width after px-4 (18px * 2) padding */
}

/* --- PRINT STYLES --- */
@media print {
  header,
  footer,
  button,
  .no-print {
    display: none !important;
  }
  body {
    @apply bg-white text-black;
  }
  html {
    font-size: 12pt;
  }
  a {
    text-decoration: none;
    color: black;
  }
  a[href^="http"]:after {
    content: " (" attr(href) ")";
    @apply text-xs text-gray-600;
  }
  pre,
  code {
    @apply border border-gray-300 whitespace-pre-wrap;
    page-break-inside: avoid;
  }
}

/**
 * Component-Specific Styles
 * Scholarly Minimalist Design System
 */

@layer components {
  /* --- LAYOUT COMPONENTS --- */

  /* Header */
  header {
    /* 
       FIXED: z-50-ზე მაღლა ავწიეთ, რომ 'Main'-ს გადაფაროს.
       მნიშვნელოვანია: არ გამოიყენოთ 'transform' ან 'filter' აქ, 
       თორემ 'fixed' შვილი ელემენტები გაფუჭდება.
    */
    @apply relative z-50 w-full bg-transparent transition-colors duration-300;
  }

  /* Main Content Area */
  main {
    @apply mx-auto w-full flex-1;
    max-width: var(--main-width);
    padding-inline: 1rem;

    /* 
       CRITICAL FIX: ეს აუცილებელია! 
       ეს ქმნის ახალ კონტექსტს (0), რათა View Transition-მა 
       ელემენტი (სათაური) არ "ამოაგდოს" ჰეღერის ზემოთ.
    */
    position: relative;
    z-index: 0;
  }

  /* Vertical Rhythm */
  main > * + * {
    margin-top: 2rem;
  }

  /* --- FEATURE COMPONENTS --- */

  .post-entry {
    @apply relative border-l-4 border-transparent pl-4 transition-all duration-200;
  }

  .post-entry:hover,
  .post-entry:focus-within {
    @apply rounded-r-md border-accent bg-muted;
  }

  /* Enhanced Post Summary Card */
  .post-summary-item {
    @apply transition-all duration-200;
  }

  .post-summary-item .post-entry {
    @apply border-l-0;
  }

  .post-summary-item:hover .post-entry,
  .post-summary-item:focus-within .post-entry {
    @apply rounded-lg;
  }

  /* Featured Post Card Enhanced */
  .post-featured-card {
    @apply transition-all duration-300;
  }

  .post-featured-card:hover {
    @apply shadow-xl shadow-accent/10;
  }

  /* Post Hero Title */
  .post-hero-title {
    @apply text-center font-bold text-foreground;
    font-family: var(--font-inter), sans-serif;
    font-size: clamp(2rem, 5vw, 3rem);
    line-height: 1.1;
    letter-spacing: -0.02em;
    text-wrap: balance;

    /* 
       უსაფრთხოებისთვის: თუ view-transition აქტიურია, 
       ეს ეუბნება ბრაუზერს, რომ ელემენტი main-ის კონტექსტში დარჩეს 
    */
    position: relative;
    z-index: 1;
  }

  .post-hero-meta {
    @apply mt-4 flex flex-wrap items-center justify-between gap-4 border-b border-dashed border-border pb-4;
  }

  .metadata {
    @apply flex items-center gap-3 text-sm font-medium text-text-secondary;
  }

  .pagination {
    @apply my-12 flex list-none justify-center gap-4 p-0;
  }

  .pagination a,
  .pagination span {
    @apply rounded-md border border-border px-4 py-2 text-sm transition-colors;
  }

  .pagination a:hover {
    @apply border-accent bg-muted text-accent;
  }

  .pagination .active {
    @apply border-accent bg-accent font-medium text-background;
  }

  .tag {
    @apply mr-2 mb-2 inline-flex items-center rounded-full px-3 py-1 text-sm transition-colors;
    @apply border border-transparent bg-muted text-foreground;
  }

  .tag:hover {
    @apply border-accent/20 bg-accent/10 text-accent;
  }

  /* Posts Grid Container */
  .posts-container {
    @apply grid gap-6;
  }

  .posts-list {
    @apply space-y-0;
  }

  /* Post Card Metadata Layout */
  .post-metadata {
    @apply flex flex-wrap items-center gap-4 text-sm;
  }

  /* Tag Preview Container */
  .tag-preview {
    @apply flex flex-wrap gap-2;
  }

  /* Empty State */
  .posts-empty {
    @apply rounded-lg border-2 border-dashed border-border/40 p-8 text-center;
  }

  .posts-empty h3 {
    @apply mb-2 text-xl font-bold text-foreground;
  }

  .posts-empty p {
    @apply text-text-secondary;
  }

  .search-container {
    @apply relative mb-6;
  }

  .search-input {
    @apply w-full rounded-lg border border-border bg-background px-4 py-3 text-foreground transition-all;
    font-size: 1rem;
  }

  .search-input:focus {
    @apply border-accent ring-2 ring-accent/20 outline-none;
  }

  /* --- ACCESSIBILITY UTILITIES --- */

  .visually-hidden {
    @apply sr-only;
  }

  /* --- SPECIALIZED COMPONENTS --- */

  .active-nav {
    @apply font-medium text-accent;
    text-decoration-line: underline;
    text-decoration-style: wavy;
    text-decoration-thickness: 2px;
    text-underline-offset: 6px;
  }

  .astro-code {
    @apply my-6 overflow-x-auto rounded-lg border border-border/50;
    scrollbar-width: thin;
  }

  .astro-code::-webkit-scrollbar {
    height: 8px;
  }

  .astro-code::-webkit-scrollbar-thumb {
    @apply rounded-full bg-muted;
  }
}

/* 
   MOBILE MENU CRITICAL OVERRIDES
*/
@media (max-width: 640px) {
  #mobile-menu-overlay {
    /* იყენებს ფიქსირებულ პოზიციას Viewport-ის მიმართ */
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100dvh;

    /* 
       Max Int Z-Index: გარანტია რომ ყველაფერს გადაფარავს. 
       მაგრამ მთავარია header-ის z-index > main-ის z-index-ზე.
    */
    z-index: 2147483647;

    /* სრული გაუმჭვირვალობა */
    background-color: var(--background);

    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 2rem;
    padding: 1rem;

    /* Hardware Acceleration-ის იძულება, რომ ახალ შრედ დახატოს */
    transform: translateZ(0);
    will-change: opacity, transform;
  }

  #mobile-menu-overlay.hidden {
    display: none;
  }

  #mobile-menu-overlay ul {
    @apply flex w-full flex-col items-center gap-6;
  }

  #mobile-menu-overlay a {
    @apply block py-2 text-2xl font-medium;
  }

  #menu-close-btn {
    position: absolute;
    top: 1.5rem;
    right: 1.5rem;
    z-index: 2147483647; /* იგივე მაქსიმუმი */
    padding: 10px;
  }

  .pagination a,
  .pagination span {
    @apply px-4 py-3 text-base;
  }

  body.menu-open {
    overflow: hidden;
  }
}

/* src/styles/typography.css */
@plugin "@tailwindcss/typography";

@layer base {
  /* Main Prose Wrapper */
  .app-prose {
    @apply prose prose-neutral dark:prose-invert;
    @apply text-foreground marker:text-accent;
    font-family: var(--font-inter), sans-serif;
    line-height: 1.7; /* Slightly increased for better readability */
    /**
     * Optimal Line Length for Readability
     * ====================================
     * 65ch ensures 65-75 characters per line across all viewport sizes.
     * This remains constant even as container width expands on 4K displays.
     * Use max-width: none on parent containers if you need full-bleed content.
     */
    max-width: 65ch;
    width: 100%;

    /**
     * Fluid Heading Typography
     * ========================
     * Using clamp() for smooth scaling from 320px to 4K (2560px).
     * Formula: clamp(min, preferred, max)
     * - min: Smallest readable size on mobile
     * - preferred: Fluid scaling based on viewport
     * - max: Largest size to prevent oversized headings on 4K
     */
    h1,
    h2,
    h3,
    h4,
    h5,
    h6,
    th {
      @apply relative scroll-mt-20 font-bold text-foreground;
      letter-spacing: -0.02em;
      line-height: 1.2;
      text-wrap: balance; /* Modern CSS for better heading line breaks */
    }
    h1 {
      @apply mb-6;
      /* Scales: 1.75rem (28px) → 3rem (48px) based on viewport */
      font-size: clamp(1.75rem, 1.25rem + 2.5vw, 3rem);
      letter-spacing: -0.03em;
    }
    h2 {
      @apply mt-10 mb-5;
      /* Scales: 1.5rem (24px) → 2.25rem (36px) */
      font-size: clamp(1.5rem, 1.15rem + 1.75vw, 2.25rem);
    }
    h3 {
      @apply mt-8 mb-4;
      /* Scales: 1.25rem (20px) → 1.875rem (30px) */
      font-size: clamp(1.25rem, 1rem + 1.25vw, 1.875rem);
    }
    h4 {
      @apply mt-6 mb-3;
      /* Scales: 1.125rem (18px) → 1.5rem (24px) */
      font-size: clamp(1.125rem, 0.95rem + 0.875vw, 1.5rem);
    }
    h5 {
      @apply mt-5 mb-2;
      /* Scales: 1rem (16px) → 1.25rem (20px) */
      font-size: clamp(1rem, 0.9rem + 0.5vw, 1.25rem);
    }
    h6 {
      @apply mt-4 mb-2;
      /* Scales: 0.875rem (14px) → 1.125rem (18px) */
      font-size: clamp(0.875rem, 0.8rem + 0.375vw, 1.125rem);
    }

    /* Content */
    p {
      @apply mb-5 font-normal;
    }
    strong {
      @apply font-semibold text-foreground;
    }

    a {
      @apply wrap-break-word text-accent decoration-dashed underline-offset-4 transition-colors hover:text-accent/80 focus-visible:rounded-sm focus-visible:outline-accent;
    }

    ul,
    ol {
      @apply my-6 list-outside;
    }
    li {
      @apply pl-1.5;
    }

    /* Tables */
    table {
      @apply my-6 w-full border-collapse text-left;
      th,
      td {
        @apply border border-border p-3 align-top;
      }
      th {
        @apply bg-muted/30 font-semibold;
      }
    }

    blockquote {
      @apply my-6 border-l-4 border-accent/40 pl-4 italic opacity-90;
    }
    figcaption {
      @apply mt-2 text-center text-sm text-text-secondary italic;
    }

    /* Code */
    :not(pre) > code {
      @apply rounded bg-muted px-1.5 py-0.5 text-[0.9em] text-foreground before:hidden after:hidden;
      font-family: var(--font-jetbrains-mono), monospace;
    }
    pre {
      @apply my-6 overflow-x-auto rounded-lg border border-border p-4;
      font-family: var(--font-jetbrains-mono), monospace;
    }

    /* Math */
    .katex,
    .katex-display {
      @apply text-foreground;
    }

    /* 
      MOBILE OPTIMIZATIONS 
      These rules allow "bleeding" content to the edge on mobile screens (<640px)
      to maximize usage of the limited horizontal space for complex elements.
      Note: Heading sizes now use clamp() for fluid scaling, so no font-size overrides needed.
    */
    @media (max-width: 640px) {
      /* Tighter spacing on mobile */
      h1 {
        @apply mb-4;
      }
      h2 {
        @apply mt-8 mb-4;
      }
      h3 {
        @apply mt-6 mb-3;
      }
      h4 {
        @apply mt-4 mb-2;
      }

      /* 
        Bleed Effect:
        Uses fluid padding variable to calculate proper negative margin.
        This ensures bleed works correctly across all viewport sizes.
      */
      figure,
      .astro-code,
      pre,
      table {
        --bleed-margin: calc(var(--layout-padding-fluid, 1rem) * -1);
        margin-inline: var(--bleed-margin);
        width: calc(100% + var(--layout-padding-fluid, 1rem) * 2);
        @apply rounded-none border-x-0;
      }

      img {
        @apply rounded-none;
      }

      /* Compact table for mobile */
      table {
        th,
        td {
          @apply p-2 text-xs;
        }
      }
    }
  }

  .main-heading {
    @apply leading-tight font-bold;
    font-family: var(--font-inter), sans-serif;
    /**
     * Enhanced Fluid Typography for Main Headings
     * ============================================
     * Scales smoothly from 320px mobile to 4K (2560px+)
     * min: 1.75rem (28px) - Readable on smallest screens
     * max: 4rem (64px) - Impactful on 4K without overwhelming
     * preferred: 1.25rem + 3.5vw - Smooth transition curve
     */
    font-size: clamp(1.75rem, 1.25rem + 3.5vw, 4rem);
    letter-spacing: -0.03em;
    text-wrap: balance;
  }

  /**
   * Utility Classes for Fluid Typography
   * =====================================
   * Use these to ensure readable line lengths in flexible containers
   */
  .readable-width {
    max-width: 65ch;
    width: 100%;
  }

  .wide-readable-width {
    max-width: 75ch;
    width: 100%;
  }
}
